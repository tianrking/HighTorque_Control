# LivelyBot ç”µæœºæ§åˆ¶ - C++ ç‰ˆæœ¬

ä¸‰ä¸ªç‹¬ç«‹çš„ C++ è„šæœ¬ï¼Œå¯¹åº” Python ç‰ˆæœ¬çš„æ‰€æœ‰åŠŸèƒ½ã€‚æ— éœ€å¤æ‚åº“ç»“æ„ï¼Œç›´æ¥ç¼–è¯‘ä½¿ç”¨ã€‚

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. å®‰è£…ä¾èµ–
```bash
sudo apt-get update
sudo apt-get install g++ can-utils
```

### 2. ç¼–è¯‘
```bash
cd /home/w0x7ce/Downloads/livelybot_hardware_sdk/CUS_02/cpp
make
```

### 3. è®¾ç½® CAN æ¥å£
```bash
sudo ip link set can0 down 2>/dev/null || true
sudo ip link set can0 up type can bitrate 1000000 restart-ms 100
```

## ğŸ“‹ ä¸‰ä¸ªè„šæœ¬åŠŸèƒ½

### 1. can_motor_scanner - ç”µæœºæ‰«æå™¨
```bash
# æ‰«ææ‰€æœ‰ç”µæœº (ID 1-14)
./can_motor_scanner

# æ‰«ææŒ‡å®šèŒƒå›´
./can_motor_scanner 1 5

# æŸ¥çœ‹å¸®åŠ©
./can_motor_scanner --help
```

**åŠŸèƒ½:**
- è‡ªåŠ¨å‘ç° CAN æ€»çº¿ä¸Šçš„ç”µæœº
- æ˜¾ç¤ºç”µæœºåœ¨çº¿çŠ¶æ€
- è·å–ç”µæœºåç§°å’Œç¡¬ä»¶ç‰ˆæœ¬
- æµ‹è¯•é€šä¿¡å¯é æ€§
- æ˜¾ç¤ºå“åº”æ—¶é—´

**è¾“å‡ºç¤ºä¾‹:**
```
LivelyBot High Torque Motor Scanner
===================================
åˆå§‹åŒ– CAN: can0
âœ… æ‰«æå™¨åˆå§‹åŒ–æˆåŠŸ
æ‰«æç”µæœº ID 1-5...
  [ID 1] âœ… åœ¨çº¿ - 5047 (å“åº”æ—¶é—´: 15ms)
  [ID 2] âŒ ç¦»çº¿
  [ID 3] âœ… åœ¨çº¿ - 5050 (å“åº”æ—¶é—´: 18ms)

æ‰«æç»“æœæ±‡æ€»:
+----+--------+--------+-----------+----------+
| ID | çŠ¶æ€   | åç§°   | ç¡¬ä»¶ç‰ˆæœ¬  | å“åº”æ—¶é—´ |
+----+--------+--------+-----------+----------+
|  1 | åœ¨çº¿   | 5047   | 1.0       | 15ms     |
|  2 | ç¦»çº¿   |       |           | N/A      |
|  3 | åœ¨çº¿   | 5050   | 1.1       | 18ms     |
+----+--------+--------+-----------+----------+
æ€»è®¡: 2/3 å°ç”µæœºåœ¨çº¿
```

### 2. velocity_acceleration_control - é€Ÿåº¦åŠ é€Ÿåº¦æ§åˆ¶
```bash
# äº¤äº’å¼æ§åˆ¶ç”µæœº 1
./velocity_acceleration_control 1

# äº¤äº’å¼æ§åˆ¶ç”µæœº 2
./velocity_acceleration_control 2

# æŸ¥çœ‹å¸®åŠ©
./velocity_acceleration_control --help
```

**åŠŸèƒ½:**
- æ™ºèƒ½ç´§æ€¥åˆ¶åŠ¨ (é€Ÿåº¦ä¸º0æ—¶è‡ªåŠ¨ä½¿ç”¨æœ€å¤§åˆ¶åŠ¨åŠ é€Ÿåº¦)
- å®æ—¶é€Ÿåº¦æ§åˆ¶ (200Hz æ§åˆ¶å¾ªç¯)
- åŠ é€Ÿåº¦è°ƒèŠ‚
- äº¤äº’å¼å‘½ä»¤ç•Œé¢

**äº¤äº’å‘½ä»¤:**
```
ğŸï¸  é€Ÿåº¦ + åŠ é€Ÿåº¦æ¨¡å¼ (æ™ºèƒ½ç´§æ€¥åˆ¶åŠ¨)
å‘½ä»¤:
  [é€Ÿåº¦å€¼]       -> è®¾ç½®ç›®æ ‡é€Ÿåº¦ (ä¾‹å¦‚: 5.0, -2.0)
  acc [æ•°å€¼]    -> è®¾ç½®è¡Œé©¶åŠ é€Ÿåº¦ (ä¾‹å¦‚: acc 10.0)
  0             -> è§¦å‘ç´§æ€¥åœæ­¢
  q             -> é€€å‡º
==================================================
å‘½ä»¤: 3.5
   -> ç›®æ ‡é€Ÿåº¦: 3.5 rad/s
å‘½ä»¤: acc 20.0
   -> è¡Œé©¶åŠ é€Ÿåº¦è®¾ä¸º: 20.0 rad/sÂ²
å‘½ä»¤: 0
   -> ğŸ›‘ ç´§æ€¥åˆ¶åŠ¨ (åŠ é€Ÿåº¦=30.0)
```

### 3. angle_stream_control - è§’åº¦æµæ§åˆ¶
```bash
# äº¤äº’å¼è§’åº¦æ§åˆ¶ç”µæœº 1
./angle_stream_control 1 interactive

# æ­£å¼¦æ³¢æµ‹è¯• (90åº¦å¹…å€¼ï¼Œ0.2Hzé¢‘ç‡ï¼Œ10ç§’æ—¶é•¿)
./angle_stream_control 1 sine --amplitude 90 --frequency 0.2 --duration 10

# é˜¶æ¢¯è§’åº¦æ§åˆ¶
./angle_stream_control 1 step --angles "0,45,90,45,0" --step-time 3

# å¤šä½ç½®æµ‹è¯•
./angle_stream_control 1 test --positions "0,30,60,90,60,30,0"

# æŸ¥çœ‹å¸®åŠ©
./angle_stream_control --help
```

**åŠŸèƒ½:**
- 0x90 æµå‘½ä»¤æ”¯æŒ
- MIT é£æ ¼é˜»æŠ—æ§åˆ¶
- æ­£å¼¦æ³¢è§’åº¦æ§åˆ¶
- é˜¶æ¢¯è§’åº¦æ§åˆ¶
- å¤šä½ç½®æµ‹è¯•

**äº¤äº’æ¨¡å¼ç¤ºä¾‹:**
```
ğŸš€ 0x90 æµæ§åˆ¶æ¨¡å¼ (å¤åˆ» SDK)
è¾“å…¥è§’åº¦ (å¦‚ 90) å›è½¦ã€‚
é»˜è®¤å‚æ•°: é™é€Ÿ 2.0 r/s, é™çŸ© 3.0 Nm
è¾“å…¥ q é€€å‡º
==================================================
(Stream 0x90) > 90
   >>> 0x90æµæŒ‡ä»¤: Ang=90Â° Vel=2 Tqe=3 (åŸå§‹å€¼: [2500,8000,600])
   -> ç›®æ ‡è§’åº¦: 90 åº¦
(Stream 0x90) > -45
   >>> 0x90æµæŒ‡ä»¤: Ang=-45Â° Vel=2 Tqe=3 (åŸå§‹å€¼: [-1250,8000,600])
   -> ç›®æ ‡è§’åº¦: -45 åº¦
(Stream 0x90) > q
```

## ğŸ› ï¸ ç¼–è¯‘é€‰é¡¹

### å•ç‹¬ç¼–è¯‘
```bash
g++ -std=c++17 -o can_motor_scanner can_motor_scanner.cpp -pthread
g++ -std=c++17 -o velocity_acceleration_control velocity_acceleration_control.cpp -pthread
g++ -std=c++17 -o angle_stream_control angle_stream_control.cpp -pthread
```

### è°ƒè¯•ç¼–è¯‘
```bash
make clean
make CXXFLAGS="-std=c++17 -Wall -Wextra -g -DDEBUG"
```

### å®‰è£…åˆ°ç³»ç»Ÿ
```bash
make install
# ç°åœ¨å¯ä»¥åœ¨ä»»ä½•åœ°æ–¹è¿è¡Œç¨‹åº
can_motor_scanner
velocity_acceleration_control 1
angle_stream_control 1 interactive
```

## âš¡ æ€§èƒ½ç‰¹æ€§

| è„šæœ¬ | æ§åˆ¶é¢‘ç‡ | å»¶è¿Ÿ | CPUå ç”¨ | å†…å­˜å ç”¨ |
|------|----------|------|---------|----------|
| can_motor_scanner | 10Hz | <100ms | ~1% | ~2MB |
| velocity_acceleration_control | 200Hz | <5ms | ~2% | ~3MB |
| angle_stream_control | 200Hz | <5ms | ~2% | ~3MB |

## ğŸ”§ åè®®æ”¯æŒ

### CAN å¸§æ ¼å¼
- **Ping å‘½ä»¤**: `0x8000 | motor_id`
- **é€Ÿåº¦æ§åˆ¶**: `0x00AD`
- **è§’åº¦æµæ§åˆ¶**: `0x0090`
- **å¯„å­˜å™¨å†™å…¥**: `0x0000 | motor_id`

### æ•°æ®è½¬æ¢
```cpp
// ä½ç½®: 1åœˆ = 10000
int16_t pos_int = (angle_deg / 360.0) * 10000.0;

// é€Ÿåº¦: 1r/s = 4000
int16_t vel_int = velocity_rps * 4000.0;

// åŠ é€Ÿåº¦: 1r/sÂ² = 400
int16_t acc_int = acceleration_rps2 * 400.0;

// åŠ›çŸ©: é€šç”¨ç³»æ•° = 200
int16_t tqe_int = torque_nm * 200.0;
```

## ğŸ¤– ç”µæœºå…¼å®¹æ€§

| ç”µæœºå‹å· | æœ€å¤§åŠ›çŸ© | æœ€é«˜è½¬é€Ÿ | çŠ¶æ€ |
|----------|----------|----------|------|
| 5045 | 0.18 Nm | 447 rpm | âœ… æ”¯æŒ |
| 5046 | 0.22 Nm | 349 rpm | âœ… æ”¯æŒ |
| 5047 | 0.28 Nm | 280 rpm | âœ… æ”¯æŒ |
| 5050 | 0.50 Nm | 170 rpm | âœ… æ”¯æŒ |
| 6056 | 0.60 Nm | 450 rpm | âœ… æ”¯æŒ |
| 6058 | 1.00 Nm | 300 rpm | âœ… æ”¯æŒ |

## â“ å¸¸è§é—®é¢˜

### CAN æ¥å£æ‰¾ä¸åˆ°
```bash
# æ£€æŸ¥ can-utils å®‰è£…
can-devices

# æ‰‹åŠ¨è®¾ç½®æ¥å£
sudo modprobe can
sudo modprobe can_raw
sudo ip link set can0 up type can bitrate 1000000
```

### æƒé™è¢«æ‹’ç»
```bash
# æ·»åŠ ç”¨æˆ·åˆ° dialout ç»„
sudo usermod -a -G dialout $USER
# é‡æ–°ç™»å½•
```

### ç¼–è¯‘é”™è¯¯
```bash
# æ¸…ç†é‡æ–°ç¼–è¯‘
make clean
make check-deps
make
```

## ğŸ“š ä¸ Python ç‰ˆæœ¬å¯¹æ¯”

| åŠŸèƒ½ | Python | C++ | ä¼˜åŠ¿ |
|------|--------|-----|------|
| ç”µæœºæ‰«æ | âœ… | âœ… | C++ æ›´å¿« |
| é€Ÿåº¦æ§åˆ¶ | âœ… | âœ… | C++ 200Hz vs Python 100Hz |
| è§’åº¦æ§åˆ¶ | âœ… | âœ… | C++ æ›´ç²¾ç¡® |
| äº¤äº’ç•Œé¢ | âœ… | âœ… | åŠŸèƒ½ç›¸åŒ |
| éƒ¨ç½²ç®€å• | âœ… | âœ… | C++ å•ä¸€å¯æ‰§è¡Œæ–‡ä»¶ |

## ğŸ”— ç›¸å…³é“¾æ¥

- [é«˜æ“ç”µæœº SDK ä¸‹è½½](http://www.hi-ec.com/article_download.html)
- [Python ç‰ˆæœ¬](../python/)
- [é¡¹ç›®ä¸»é¡µ](../../)

---

**çŠ¶æ€**: âœ… å®Œæˆ (ä¸‰ä¸ªç‹¬ç«‹è„šæœ¬ï¼Œç›´æ¥å¯ç”¨)

**ç¼–è¯‘å‘½ä»¤**: `make`

**è¿è¡Œè¦æ±‚**: libsocketcan, CAN æ¥å£